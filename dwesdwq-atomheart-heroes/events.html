<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Мероприятия | AtomHeart Heroes</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/feather-icons"></script>
</head>
<body class="bg-gray-900">
    <!-- Красивый фон -->
    <div class="background-wrapper"></div>
    <div class="particles-container">
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
    </div>
    <div class="light-rays">
        <div class="ray"></div>
        <div class="ray"></div>
        <div class="ray"></div>
        <div class="ray"></div>
    </div>
    
    <custom-navbar></custom-navbar>
    
    <main class="main-content container mx-auto px-4 py-8">
        <div class="max-w-6xl mx-auto">
            <!-- Заголовок -->
            <div class="text-center mb-12 fade-in-up">
                <h1 class="text-5xl md:text-6xl font-black mb-6 gradient-text leading-tight">
                    Мероприятия
                </h1>
                <p class="text-xl text-gray-300 max-w-3xl mx-auto font-medium">
                    Все доступные мероприятия для волонтеров
                </p>
            </div>

            <!-- Кнопка назад -->
            <div class="mb-8 fade-in-up">
                <a href="index.html" class="btn-back btn-wave inline-flex items-center">
                    <i data-feather="arrow-left" class="w-5 h-5"></i>
                    Назад на главную
                </a>
            </div>

            <!-- Фильтры -->
            <div class="card p-6 mb-8 fade-in-up">
                <div class="flex flex-col lg:flex-row gap-6 items-center">
                    <div class="flex-1">
                        <label class="block text-sm font-semibold text-gray-700 mb-3">Город</label>
                        <select id="cityFilter" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-300">
                            <option value="">Все города</option>
                            <option value="Дубна">Дубна</option>
                            <option value="Сосновый Бор">Сосновый Бор</option>
                            <option value="Новоуральск">Новоуральск</option>
                            <option value="Озёрск">Озёрск</option>
                            <option value="Обнинск">Обнинск</option>
                            <option value="Саров">Саров</option>
                        </select>
                    </div>
                    <div class="flex-1">
                        <label class="block text-sm font-semibold text-gray-700 mb-3">Категория</label>
                        <select id="categoryFilter" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-300">
                            <option value="">Все категории</option>
                            <option value="Экология">Экология</option>
                            <option value="Спорт">Спорт</option>
                            <option value="Образование">Образование</option>
                            <option value="Социальная помощь">Социальная помощь</option>
                            <option value="Благоустройство">Благоустройство</option>
                            <option value="Культура">Культура</option>
                        </select>
                    </div>
                    <div class="flex-1">
                        <label class="block text-sm font-semibold text-gray-700 mb-3">Дата</label>
                        <input type="date" id="dateFilter" 
                               class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-300">
                    </div>
                </div>
            </div>

            <!-- Список мероприятий -->
            <div id="eventsList">
                <!-- Мероприятия будут загружены динамически -->
            </div>
        </div>
    </main>
    
    <custom-footer></custom-footer>
    
    <script src="components/navbar.js"></script>
    <script src="components/footer.js"></script>
    <script src="script.js"></script>
    <script>
        feather.replace();

        // Загрузка мероприятий
        document.addEventListener('DOMContentLoaded', function() {
            loadEvents();
            
            // Обработчики фильтров
            document.getElementById('cityFilter').addEventListener('change', loadEvents);
            document.getElementById('categoryFilter').addEventListener('change', loadEvents);
            document.getElementById('dateFilter').addEventListener('change', loadEvents);
        });

        function loadEvents() {
            const cityFilter = document.getElementById('cityFilter').value;
            const categoryFilter = document.getElementById('categoryFilter').value;
            const dateFilter = document.getElementById('dateFilter').value;

            // Получаем мероприятия из системы событий
            if (typeof volunteerEventsSystem !== 'undefined') {
                const events = volunteerEventsSystem.getPublicEvents({
                    city: cityFilter,
                    category: categoryFilter,
                    date: dateFilter
                });
                displayEvents(events);
            } else {
                // Если система событий не загружена, показываем сообщение
                displayNoEvents();
            }
        }

        function displayEvents(events) {
            const container = document.getElementById('eventsList');
            
            if (events.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-12">
                        <div class="w-24 h-24 mx-auto mb-6 bg-gray-200 rounded-2xl flex items-center justify-center text-gray-400">
                            <i data-feather="calendar" class="w-12 h-12"></i>
                        </div>
                        <h3 class="text-xl font-bold text-gray-800 mb-2">Мероприятия не найдены</h3>
                        <p class="text-gray-600 mb-6">Попробуйте изменить параметры фильтров</p>
                        <button onclick="resetFilters()" class="btn btn-primary">
                            Сбросить фильтры
                        </button>
                    </div>
                `;
                feather.replace();
                return;
            }

            container.innerHTML = events.map(event => `
                <div class="card p-6 mb-6 group hover:scale-105 transition-all duration-300">
                    <div class="flex flex-col lg:flex-row gap-6">
                        ${event.image ? `
                        <div class="lg:w-1/3">
                            <img src="${event.image}" alt="${event.title}" 
                                 class="w-full h-48 object-cover rounded-xl shadow-lg group-hover:shadow-xl transition-shadow">
                        </div>
                        ` : ''}
                        
                        <div class="${event.image ? 'lg:w-2/3' : 'w-full'}">
                            <div class="flex flex-wrap items-center gap-2 mb-3">
                                <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded-full text-xs font-medium">
                                    ${event.city}
                                </span>
                                <span class="${getCategoryColorClass(event.category)} text-white px-2 py-1 rounded-full text-xs font-medium">
                                    ${event.category}
                                </span>
                                <span class="text-gray-500 text-sm">${formatDate(event.date)}</span>
                                <span class="text-gray-500 text-sm flex items-center">
                                    <i data-feather="users" class="w-4 h-4 mr-1"></i>
                                    ${event.participants || 0}/${event.maxParticipants || 50}
                                </span>
                            </div>
                            
                            <h3 class="text-xl font-bold text-gray-800 mb-3 group-hover:text-blue-600 transition-colors">
                                ${event.title}
                            </h3>
                            
                            <p class="text-gray-600 mb-4 leading-relaxed">${event.description}</p>
                            
                            <div class="flex items-center justify-between">
                                <div class="flex items-center text-gray-600 text-sm">
                                    <i data-feather="users" class="w-4 h-4 mr-2"></i>
                                    ${event.organization}
                                </div>
                                <div class="flex items-center space-x-2">
                                    <button onclick="viewEventDetails(${event.id})" class="btn btn-glass btn-sm">
                                        Подробнее
                                    </button>
                                    <button onclick="registerForEvent(${event.id})" class="btn btn-primary btn-sm">
                                        Записаться
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
            feather.replace();
        }

        function displayNoEvents() {
            const container = document.getElementById('eventsList');
            container.innerHTML = `
                <div class="text-center py-12">
                    <div class="w-24 h-24 mx-auto mb-6 bg-gray-200 rounded-2xl flex items-center justify-center text-gray-400">
                        <i data-feather="calendar" class="w-12 h-12"></i>
                    </div>
                    <h3 class="text-xl font-bold text-gray-800 mb-2">Система мероприятий не загружена</h3>
                    <p class="text-gray-600 mb-6">Попробуйте обновить страницу</p>
                    <button onclick="location.reload()" class="btn btn-primary">
                        Обновить страницу
                    </button>
                </div>
            `;
            feather.replace();
        }

        function resetFilters() {
            document.getElementById('cityFilter').value = '';
            document.getElementById('categoryFilter').value = '';
            document.getElementById('dateFilter').value = '';
            loadEvents();
        }

        function getCategoryColorClass(category) {
            const colors = {
                'Экология': 'bg-green-500',
                'Спорт': 'bg-red-500',
                'Образование': 'bg-blue-500',
                'Социальная помощь': 'bg-purple-500',
                'Благоустройство': 'bg-orange-500',
                'Культура': 'bg-pink-500'
            };
            return colors[category] || 'bg-blue-500';
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('ru-RU', { 
                day: 'numeric', 
                month: 'long',
                year: 'numeric'
            });
        }

        function viewEventDetails(eventId) {
            window.location.href = `event-single.html?id=${eventId}`;
        }

        function registerForEvent(eventId) {
            const currentVolunteer = JSON.parse(localStorage.getItem('currentVolunteer') || 'null');
            
            if (!currentVolunteer) {
                alert('Для записи на мероприятие необходимо войти в систему');
                window.location.href = 'volunteer-login.html';
                return;
            }

            if (typeof volunteerEventsSystem !== 'undefined') {
                const result = volunteerEventsSystem.registerVolunteer(eventId, {
                    email: currentVolunteer.email,
                    name: currentVolunteer.fullName,
                    phone: currentVolunteer.phone
                });

                if (result.success) {
                    showNotification(result.message, 'success');
                    loadEvents(); // Обновляем список
                } else {
                    showNotification(result.message, 'error');
                }
            }
        }

        // Глобальные функции
        window.resetFilters = resetFilters;
        window.viewEventDetails = viewEventDetails;
        window.registerForEvent = registerForEvent;
    </script>
</body>
</html>