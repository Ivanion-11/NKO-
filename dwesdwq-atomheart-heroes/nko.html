<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>НКО | AtomHeart Heroes</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/feather-icons"></script>
</head>
<body class="bg-gray-900">
    <!-- Красивый фон -->
    <div class="background-wrapper"></div>
    <div class="particles-container">
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
    </div>
    <div class="light-rays">
        <div class="ray"></div>
        <div class="ray"></div>
        <div class="ray"></div>
        <div class="ray"></div>
    </div>
    
    <custom-navbar></custom-navbar>
    
    <main class="main-content container mx-auto px-4 py-8">
        <div class="max-w-6xl mx-auto">
            <!-- Заголовок -->
            <div class="text-center mb-12 fade-in-up">
                <h1 class="text-5xl md:text-6xl font-black mb-6 gradient-text leading-tight">
                    Некоммерческие организации
                </h1>
                <p class="text-xl text-gray-300 max-w-3xl mx-auto font-medium">
                    Найдите организации для сотрудничества и участия в проектах
                </p>
            </div>

            <!-- Кнопка назад -->
            <div class="mb-8 fade-in-up">
                <a href="index.html" class="btn-back btn-wave inline-flex items-center">
                    <i data-feather="arrow-left" class="w-5 h-5"></i>
                    Назад на главную
                </a>
            </div>

            <!-- Фильтры -->
            <div class="card p-6 mb-8 fade-in-up">
                <div class="flex flex-col lg:flex-row gap-6 items-center">
                    <div class="flex-1">
                        <label class="block text-sm font-semibold text-gray-700 mb-3">Город</label>
                        <select id="cityFilter" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-300">
                            <option value="">Все города</option>
                            <option value="Дубна">Дубна</option>
                            <option value="Сосновый Бор">Сосновый Бор</option>
                            <option value="Новоуральск">Новоуральск</option>
                            <option value="Озёрск">Озёрск</option>
                            <option value="Обнинск">Обнинск</option>
                            <option value="Саров">Саров</option>
                        </select>
                    </div>
                    <div class="flex-1">
                        <label class="block text-sm font-semibold text-gray-700 mb-3">Категория</label>
                        <select id="categoryFilter" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-300">
                            <option value="">Все категории</option>
                            <option value="Экология">Экология</option>
                            <option value="Спорт">Спорт</option>
                            <option value="Образование">Образование</option>
                            <option value="Социальная помощь">Социальная помощь</option>
                            <option value="Благоустройство">Благоустройство</option>
                            <option value="Культура">Культура</option>
                        </select>
                    </div>
                    <div class="flex-1">
                        <label class="block text-sm font-semibold text-gray-700 mb-3">Поиск</label>
                        <input type="text" id="searchInput" placeholder="Поиск организаций..." 
                               class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-300">
                    </div>
                </div>
            </div>

            <!-- Список НКО -->
            <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8" id="nkoList">
                <!-- НКО будут загружены динамически -->
            </div>

            <!-- Кнопка регистрации НКО -->
            <div class="text-center fade-in-up">
                <a href="register-nko.html" class="btn btn-primary btn-wave btn-icon">
                    <i data-feather="plus" class="w-5 h-5"></i>
                    Зарегистрировать НКО
                </a>
            </div>
        </div>
    </main>
    
    <custom-footer></custom-footer>
    
    <script src="components/navbar.js"></script>
    <script src="components/footer.js"></script>
    <script src="script.js"></script>
    <script>
        feather.replace();

        // Загрузка списка НКО
        document.addEventListener('DOMContentLoaded', function() {
            loadNKOList();
            
            // Обработчики фильтров
            document.getElementById('cityFilter').addEventListener('change', loadNKOList);
            document.getElementById('categoryFilter').addEventListener('change', loadNKOList);
            document.getElementById('searchInput').addEventListener('input', loadNKOList);
        });

        function loadNKOList() {
            const cityFilter = document.getElementById('cityFilter').value;
            const categoryFilter = document.getElementById('categoryFilter').value;
            const searchQuery = document.getElementById('searchInput').value.toLowerCase();

            // Получаем список НКО из localStorage
            const nkoList = JSON.parse(localStorage.getItem('approvedNko') || '[]');
            const pendingNKO = JSON.parse(localStorage.getItem('pendingNkoRegistrations') || '[]');
            
            // Объединяем одобренные и ожидающие НКО
            const allNKO = [...nkoList, ...pendingNKO];

            // Фильтрация
            let filteredNKO = allNKO.filter(nko => {
                const cityMatch = !cityFilter || nko.city === cityFilter;
                const categoryMatch = !categoryFilter || nko.category === categoryFilter;
                const searchMatch = !searchQuery || 
                    nko.orgName.toLowerCase().includes(searchQuery) ||
                    nko.description.toLowerCase().includes(searchQuery);
                
                return cityMatch && categoryMatch && searchMatch;
            });

            displayNKOList(filteredNKO);
        }

        function displayNKOList(nkoList) {
            const container = document.getElementById('nkoList');
            
            if (nkoList.length === 0) {
                container.innerHTML = `
                    <div class="col-span-3 text-center py-12">
                        <div class="w-24 h-24 mx-auto mb-6 bg-gray-200 rounded-2xl flex items-center justify-center text-gray-400">
                            <i data-feather="users" class="w-12 h-12"></i>
                        </div>
                        <h3 class="text-xl font-bold text-gray-800 mb-2">Организации не найдены</h3>
                        <p class="text-gray-600 mb-6">Попробуйте изменить параметры фильтров</p>
                        <button onclick="resetFilters()" class="btn btn-primary">
                            Сбросить фильтры
                        </button>
                    </div>
                `;
                feather.replace();
                return;
            }

            container.innerHTML = nkoList.map(nko => `
                <div class="card p-6 text-center group hover:scale-105 transition-all duration-300">
                    <div class="w-20 h-20 mx-auto mb-4 bg-gradient-to-r from-green-500 to-blue-500 rounded-2xl flex items-center justify-center text-white text-2xl font-bold shadow-lg group-hover:scale-110 transition-transform">
                        ${nko.orgName.substring(0, 2)}
                    </div>
                    <h4 class="font-semibold text-gray-800 mb-2">${nko.orgName}</h4>
                    <p class="text-gray-600 text-sm mb-3">${nko.city}</p>
                    <span class="inline-block ${getCategoryColorClass(nko.category)} text-white px-3 py-1 rounded-full text-xs font-medium mb-3">
                        ${nko.category}
                    </span>
                    <p class="text-gray-600 text-sm mb-4 leading-relaxed">${nko.description || 'Описание организации'}</p>
                    <div class="flex justify-center space-x-2">
                        <button onclick="viewNKO(${nko.id})" class="btn btn-primary btn-sm">
                            Подробнее
                        </button>
                        ${nko.status === 'pending' ? `
                        <span class="bg-yellow-100 text-yellow-800 px-2 py-1 rounded-full text-xs">На модерации</span>
                        ` : ''}
                    </div>
                </div>
            `).join('');
            feather.replace();
        }

        function resetFilters() {
            document.getElementById('cityFilter').value = '';
            document.getElementById('categoryFilter').value = '';
            document.getElementById('searchInput').value = '';
            loadNKOList();
        }

        function getCategoryColorClass(category) {
            const colors = {
                'Экология': 'bg-green-500',
                'Спорт': 'bg-red-500',
                'Образование': 'bg-blue-500',
                'Социальная помощь': 'bg-purple-500',
                'Благоустройство': 'bg-orange-500',
                'Культура': 'bg-pink-500'
            };
            return colors[category] || 'bg-blue-500';
        }

        function viewNKO(nkoId) {
            // Переход на страницу конкретной НКО
            window.location.href = `nko-single.html?id=${nkoId}`;
        }

        // Глобальные функции
        window.resetFilters = resetFilters;
        window.viewNKO = viewNKO;
    </script>
</body>
</html>